webpackJsonp([0],{210:function(t,e,s){var n=s(211);"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);s(44)("8fc42bfe",n,!0)},211:function(t,e,s){e=t.exports=s(43)(void 0),e.push([t.i,"",""])},212:function(t,e,s){var n=s(213);"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);s(44)("5652ccd3",n,!0)},213:function(t,e,s){e=t.exports=s(43)(void 0),e.push([t.i,"\n.separating-line {\n  border-bottom-color: rgba(0, 0, 0, 0.12);\n}\n.token--wrap-text {\n  overflow-wrap: break-word;\n}\n.token--wrap-text span {\n    max-width: 100%;\n}\n.token-list--table-body {\n  overflow-y: auto;\n  overflow-x: hidden;\n  max-height: 300px;\n  display: grid;\n  max-width: 100%;\n}\n.token-list--table-row {\n  display: inline-block;\n  white-space: normal;\n  margin-bottom: 8px;\n}\n",""])},214:function(t,e,s){var n=s(215);"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);s(44)("dcfe3e92",n,!0)},215:function(t,e,s){e=t.exports=s(43)(void 0),e.push([t.i,".spinner{-webkit-transition:opacity .15s ease;-o-transition:opacity .15s ease;transition:opacity .15s ease;-webkit-animation:rotator 1.4s linear infinite;animation:rotator 1.4s linear infinite;-webkit-animation-play-state:paused;animation-play-state:paused}.spinner.show{-webkit-animation-play-state:running;animation-play-state:running}.spinner.v-enter,.spinner.v-leave-active{opacity:0}.spinner.v-enter-active,.spinner.v-leave{opacity:1}.spinner .path{stroke:#f60;stroke-dasharray:126;stroke-dashoffset:0;-webkit-transform-origin:center;-ms-transform-origin:center;transform-origin:center;-webkit-animation:dash 1.4s ease-in-out infinite;animation:dash 1.4s ease-in-out infinite}@-webkit-keyframes rotator{0%{-webkit-transform:scale(.5) rotate(0deg);transform:scale(.5) rotate(0deg)}to{-webkit-transform:scale(.5) rotate(270deg);transform:scale(.5) rotate(270deg)}}@keyframes rotator{0%{-webkit-transform:scale(.5) rotate(0deg);transform:scale(.5) rotate(0deg)}to{-webkit-transform:scale(.5) rotate(270deg);transform:scale(.5) rotate(270deg)}}@-webkit-keyframes dash{0%{stroke-dashoffset:126}50%{stroke-dashoffset:63;-webkit-transform:rotate(135deg);transform:rotate(135deg)}to{stroke-dashoffset:126;-webkit-transform:rotate(450deg);transform:rotate(450deg)}}@keyframes dash{0%{stroke-dashoffset:126}50%{stroke-dashoffset:63;-webkit-transform:rotate(135deg);transform:rotate(135deg)}to{stroke-dashoffset:126;-webkit-transform:rotate(450deg);transform:rotate(450deg)}}",""])},216:function(t,e,s){var n=s(217);"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);s(44)("55a803a4",n,!0)},217:function(t,e,s){e=t.exports=s(43)(void 0),e.push([t.i,"\n.separating-line {\n  border-bottom-color: rgba(0, 0, 0, 0.12);\n}\n.token--wrap-text {\n  overflow-wrap: break-word;\n}\n.token-list--table-body {\n  overflow-y: auto;\n  overflow-x: hidden;\n  max-height: 300px;\n  display: grid;\n  max-width: 100%;\n}\n.token-list--table-row {\n  display: inline-block;\n  white-space: normal;\n  margin-bottom: 8px;\n}\n",""])},232:function(t,e,s){"use strict";function n(t){s(214)}function a(t){s(212)}function o(t){s(216)}function i(t){s(210)}Object.defineProperty(e,"__esModule",{value:!0});var r={name:"spinner",props:["show"],serverCacheKey:function(t){return t.show}},c=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("transition",[s("svg",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"show"}],staticClass:"spinner",class:{show:t.show},attrs:{width:"44px",height:"44px",viewBox:"0 0 44 44"}},[s("circle",{staticClass:"path",attrs:{fill:"none","stroke-width":"4","stroke-linecap":"round",cx:"22",cy:"22",r:"20"}})])])},l=[],d={render:c,staticRenderFns:l},u=d,m=s(21),f=n,p=m(r,u,!1,f,null,null),h=p.exports,v={components:{Spinner:h},data:function(){return{tokenList:[],destUserId:"",loading:!1,chosenDebugUser:""}},created:function(){},computed:{debugUsers:function(){return this.$store.state.debugUsers}},watch:{destUserId:function(t){t&&(this.chosenDebugUser="")},chosenDebugUser:function(t){t&&(this.destUserId="")}},asyncData:function(t){return t.store.dispatch("FETCH_DEBUG_USERS")},methods:{sendRequest:function(){var t=this;this.chosenDebugUser&&(this.destUserId=this.chosenDebugUser),console.log("retrieving token");var e="/api/tokens/"+this.destUserId;this.loading=!0,fetch(e).then(function(t){return t.json()}).then(function(e){t.loading=!1,console.log(e),"failure"===e.status?t.tokenList=[]:t.tokenList=Object.keys(e.result).map(function(t){return{token:t,type:e.result[t].type,lang:e.result[t].lang}})}).catch(function(e){t.loading=!1,console.error(e)})}}},_=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"mdc-card"},[t._m(0),s("section",{staticClass:"mdc-card__primary"},[s("form",{attrs:{action:"#"}},[s("div",[s("div",{staticClass:"mdc-form-field"},[s("div",{staticClass:"mdc-text-field",attrs:{"data-mdc-auto-init":"MDCTextField"}},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.destUserId,expression:"destUserId"}],staticClass:"mdc-text-field__input",attrs:{id:"token-dest-user-id",type:"text"},domProps:{value:t.destUserId},on:{input:function(e){e.target.composing||(t.destUserId=e.target.value)}}}),s("label",{staticClass:"mdc-text-field__label",attrs:{for:"token-dest-user-id"}},[t._v("\n              User ID\n            ")]),s("div",{staticClass:"mdc-text-field__bottom-line"})])])])])]),s("hr",{staticClass:"mdc-list-divider separating-line"}),s("section",{staticClass:"mdc-card__primary"},[s("form",{attrs:{action:"#"}},[t._v("\n      OR pick a debug User ID:\n      "),s("div",{staticClass:"mdc-select"},[s("select",{directives:[{name:"model",rawName:"v-model",value:t.chosenDebugUser,expression:"chosenDebugUser"}],staticClass:"mdc-select__surface",on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.chosenDebugUser=e.target.multiple?s:s[0]}}},[s("option",{attrs:{value:""}},[t._v("Choose...")]),t._l(t.debugUsers,function(e){return s("option",{domProps:{value:e.userId}},[t._v(t._s(e.username))])})],2),s("div",{staticClass:"mdc-select__bottom-line"})])])]),s("hr",{staticClass:"mdc-list-divider separating-line"}),s("section",{staticClass:"mdc-card__primary"},[t._v("\n    fetch('https://iceicebaby.com/api/tokens/"+t._s(t.destUserId||t.chosenDebugUser)+"')\n  ")]),s("section",{directives:[{name:"show",rawName:"v-show",value:t.tokenList.length>0||t.loading,expression:"tokenList.length > 0 || loading"}],staticClass:"mdc-card__supporting-text"},[s("Spinner",{attrs:{show:t.loading}}),s("ul",{staticClass:"mdc-list mdc-list--two-line mdc-list--dense demo-list token-list--table-body"},t._l(t.tokenList,function(e){return s("li",{staticClass:"mdc-list-item token-list--table-row token--wrap-text"},[s("span",{staticClass:"mdc-list-item__text"},[t._v("\n          "+t._s(e.type)+" ("+t._s(e.lang)+")\n          "),s("span",{staticClass:"mdc-list-item__secondary-text"},[t._v(t._s(e.token))])])])}))],1),s("section",{staticClass:"mdc-card__actions"},[s("button",{staticClass:"mdc-button mdc-button--compact mdc-card__action",on:{click:function(e){t.sendRequest()}}},[t._v("Punch It!")])])])},g=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("section",{staticClass:"mdc-card__primary"},[s("h1",{staticClass:"mdc-card__title mdc-card__title--large"},[t._v("Get List of Tokens")]),s("h2",{staticClass:"mdc-card__subtitle"},[t._v("Retrieve list of tokens depending on User ID")])])}],b={render:_,staticRenderFns:g},k=b,w=s(21),y=a,C=w(v,k,!1,y,null,null),x=C.exports,U={data:function(){return{tokenList:[],destUserId:"",loading:!0,chosenDebugUser:"",chosenLang:"",availableLang:["zh-hk","en"],hasToken:!1}},created:function(){},computed:{debugUsers:function(){return this.$store.state.debugUsers}},watch:{destUserId:function(t){t&&(this.chosenDebugUser="")},chosenDebugUser:function(t){t&&(this.destUserId="")}},asyncData:function(t){return t.store.dispatch("FETCH_DEBUG_USERS")},methods:{retrieveToken:function(){var t=this,e=firebase.messaging();this.chosenLang&&(this.destUserId||this.chosenDebugUser)&&(this.chosenDebugUser&&(this.destUserId=this.chosenDebugUser),navigator.serviceWorker.register("/service-worker.js").then(function(s){e.useServiceWorker(s),e.getToken().then(function(e){if(e){console.log("get token!"),console.log(e);var s={token:e,userId:t.destUserId,lang:t.chosenLang,type:"web"};fetch("/api/token",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(s)}).then(function(t){return t.json()}).then(function(s){console.log(s),"failure"===s.status?console.log("save web token failure"):(console.log("save web token success"),t.hasToken=!0,t.$store.commit("SET_DEVICE_TOKEN",e),t.$store.commit("SET_DEVICE_USER_ID",t.destUserId),localStorage.setItem("userId",t.destUserId),localStorage.setItem("token",e))})}else console.log("No Instance ID token available. Request permission to generate one.")}).catch(function(t){console.log("An error occurred while retrieving token. ",t)})}))}}},I=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"mdc-card"},[t._m(0),s("section",{directives:[{name:"show",rawName:"v-show",value:t.tokenList.length>0,expression:"tokenList.length > 0"}],staticClass:"mdc-card__supporting-text"},[t._v("\n    Hi hi\n  ")]),s("section",{staticClass:"mdc-card__primary"},[s("form",{attrs:{action:"#"}},[s("div",[s("div",{staticClass:"mdc-form-field"},[s("div",{staticClass:"mdc-text-field",attrs:{"data-mdc-auto-init":"MDCTextField"}},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.destUserId,expression:"destUserId"}],staticClass:"mdc-text-field__input",attrs:{id:"token-dest-user-id",type:"text"},domProps:{value:t.destUserId},on:{input:function(e){e.target.composing||(t.destUserId=e.target.value)}}}),s("label",{staticClass:"mdc-text-field__label",attrs:{for:"token-dest-user-id"}},[t._v("\n              User ID\n            ")]),s("div",{staticClass:"mdc-text-field__bottom-line"})])])])])]),s("section",{staticClass:"mdc-card__primary"},[s("form",{attrs:{action:"#"}},[t._v("\n      OR pick a debug User ID:\n      "),s("div",{staticClass:"mdc-select"},[s("select",{directives:[{name:"model",rawName:"v-model",value:t.chosenDebugUser,expression:"chosenDebugUser"}],staticClass:"mdc-select__surface",on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.chosenDebugUser=e.target.multiple?s:s[0]}}},[s("option",{attrs:{value:""}},[t._v("Choose...")]),t._l(t.debugUsers,function(e){return s("option",{domProps:{value:e.userId}},[t._v(t._s(e.username))])})],2),s("div",{staticClass:"mdc-select__bottom-line"})])])]),s("hr",{staticClass:"mdc-list-divider separating-line"}),s("section",{staticClass:"mdc-card__primary"},[s("form",{attrs:{action:"#"}},[t._v("\n      Choose Language:\n      "),s("div",{staticClass:"mdc-select"},[s("select",{directives:[{name:"model",rawName:"v-model",value:t.chosenLang,expression:"chosenLang"}],staticClass:"mdc-select__surface",on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.chosenLang=e.target.multiple?s:s[0]}}},[s("option",{attrs:{value:""}},[t._v("Choose...")]),t._l(t.availableLang,function(e){return s("option",{domProps:{value:e}},[t._v(t._s(e))])})],2),s("div",{staticClass:"mdc-select__bottom-line"})])])]),s("hr",{staticClass:"mdc-list-divider separating-line"}),s("section",{directives:[{name:"show",rawName:"v-show",value:t.tokenList.length>0,expression:"tokenList.length > 0"}],staticClass:"mdc-card__supporting-text"},[s("ul",{staticClass:"mdc-list token-list--table-body"},t._l(t.tokenList,function(e){return s("li",{staticClass:"mdc-list-item token-list--table-row token--wrap-text"},[t._v("\n        "+t._s(e)+"\n      ")])}))]),s("section",{staticClass:"mdc-card__actions"},[s("button",{staticClass:"mdc-button mdc-button--compact mdc-card__action",on:{click:function(e){t.retrieveToken()}}},[t._v("Punch It!")])])])},D=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("section",{staticClass:"mdc-card__primary"},[s("h1",{staticClass:"mdc-card__title mdc-card__title--large"},[t._v("Get Token for Device")]),s("h2",{staticClass:"mdc-card__subtitle"},[t._v("Get token for your device (web only)")])])}],T={render:I,staticRenderFns:D},L=T,E=s(21),S=o,N=E(U,L,!1,S,null,null),R=N.exports,$=this&&this.__awaiter||function(t,e,s,n){return new(s||(s=Promise))(function(a,o){function i(t){try{c(n.next(t))}catch(t){o(t)}}function r(t){try{c(n.throw(t))}catch(t){o(t)}}function c(t){t.done?a(t.value):new s(function(e){e(t.value)}).then(i,r)}c((n=n.apply(t,e||[])).next())})},P=this&&this.__generator||function(t,e){function s(t){return function(e){return n([t,e])}}function n(s){if(a)throw new TypeError("Generator is already executing.");for(;c;)try{if(a=1,o&&(i=o[2&s[0]?"return":s[0]?"throw":"next"])&&!(i=i.call(o,s[1])).done)return i;switch(o=0,i&&(s=[0,i.value]),s[0]){case 0:case 1:i=s;break;case 4:return c.label++,{value:s[1],done:!1};case 5:c.label++,o=s[1],s=[0];continue;case 7:s=c.ops.pop(),c.trys.pop();continue;default:if(i=c.trys,!(i=i.length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){c=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){c.label=s[1];break}if(6===s[0]&&c.label<i[1]){c.label=i[1],i=s;break}if(i&&c.label<i[2]){c.label=i[2],c.ops.push(s);break}i[2]&&c.ops.pop(),c.trys.pop();continue}s=e.call(t,c)}catch(t){s=[6,t],o=0}finally{a=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}var a,o,i,r,c={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r},A={name:"token-page",beforeMount:function(){return $(this,void 0,void 0,function(){var t;return P(this,function(e){switch(e.label){case 0:return[4,this.$store.dispatch("UPDATE_AUTH_STATE")];case 1:return t=e.sent(),[2]}})})},mounted:function(){console.log("token page mounted")},computed:{hasToken:function(){return""!==this.$store.state.deviceToken}},components:{Token:R,TokenList:x}},F=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"demo-grid mdc-layout-grid"},[s("div",{staticClass:"mdc-layout-grid__inner"},[s("div",{directives:[{name:"show",rawName:"v-show",value:!t.hasToken,expression:"!hasToken"}],staticClass:"demo-cell mdc-layout-grid__cell mdc-layout-grid__cell--span-6 mdc-layout-grid__cell--span-8-tablet"},[s("Token")],1),s("div",{staticClass:"demo-cell mdc-layout-grid__cell mdc-layout-grid__cell--span-6 mdc-layout-grid__cell--span-8-tablet"},[s("TokenList")],1)])])},j=[],O={render:F,staticRenderFns:j},G=O,H=s(21),M=i,q=H(A,G,!1,M,null,null);e.default=q.exports}});