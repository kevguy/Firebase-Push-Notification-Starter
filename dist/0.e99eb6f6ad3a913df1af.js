webpackJsonp([0],{22:function(e,t,s){var n=s(23);"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);s(3)("79e2e21d",n,!0)},23:function(e,t,s){t=e.exports=s(2)(void 0),t.push([e.i,"",""])},24:function(e,t,s){var n=s(25);"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);s(3)("5652ccd3",n,!0)},25:function(e,t,s){t=e.exports=s(2)(void 0),t.push([e.i,"\n.separating-line {\n  border-bottom-color: rgba(0, 0, 0, 0.12);\n}\n.token--wrap-text {\n  overflow-wrap: break-word;\n}\n.token--wrap-text span {\n    max-width: 100%;\n}\n.token-list--table-body {\n  overflow-y: auto;\n  overflow-x: hidden;\n  max-height: 300px;\n  display: grid;\n  max-width: 100%;\n}\n.token-list--table-row {\n  display: inline-block;\n  white-space: normal;\n  margin-bottom: 8px;\n}\n",""])},26:function(e,t,s){var n=s(27);"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);s(3)("dcfe3e92",n,!0)},27:function(e,t,s){t=e.exports=s(2)(void 0),t.push([e.i,".spinner{-webkit-transition:opacity .15s ease;-o-transition:opacity .15s ease;transition:opacity .15s ease;-webkit-animation:rotator 1.4s linear infinite;animation:rotator 1.4s linear infinite;-webkit-animation-play-state:paused;animation-play-state:paused}.spinner.show{-webkit-animation-play-state:running;animation-play-state:running}.spinner.v-enter,.spinner.v-leave-active{opacity:0}.spinner.v-enter-active,.spinner.v-leave{opacity:1}.spinner .path{stroke:#f60;stroke-dasharray:126;stroke-dashoffset:0;-webkit-transform-origin:center;-ms-transform-origin:center;transform-origin:center;-webkit-animation:dash 1.4s ease-in-out infinite;animation:dash 1.4s ease-in-out infinite}@-webkit-keyframes rotator{0%{-webkit-transform:scale(.5) rotate(0deg);transform:scale(.5) rotate(0deg)}to{-webkit-transform:scale(.5) rotate(270deg);transform:scale(.5) rotate(270deg)}}@keyframes rotator{0%{-webkit-transform:scale(.5) rotate(0deg);transform:scale(.5) rotate(0deg)}to{-webkit-transform:scale(.5) rotate(270deg);transform:scale(.5) rotate(270deg)}}@-webkit-keyframes dash{0%{stroke-dashoffset:126}50%{stroke-dashoffset:63;-webkit-transform:rotate(135deg);transform:rotate(135deg)}to{stroke-dashoffset:126;-webkit-transform:rotate(450deg);transform:rotate(450deg)}}@keyframes dash{0%{stroke-dashoffset:126}50%{stroke-dashoffset:63;-webkit-transform:rotate(135deg);transform:rotate(135deg)}to{stroke-dashoffset:126;-webkit-transform:rotate(450deg);transform:rotate(450deg)}}",""])},28:function(e,t,s){var n=s(29);"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);s(3)("55a803a4",n,!0)},29:function(e,t,s){t=e.exports=s(2)(void 0),t.push([e.i,"\n.separating-line {\n  border-bottom-color: rgba(0, 0, 0, 0.12);\n}\n.token--wrap-text {\n  overflow-wrap: break-word;\n}\n.token-list--table-body {\n  overflow-y: auto;\n  overflow-x: hidden;\n  max-height: 300px;\n  display: grid;\n  max-width: 100%;\n}\n.token-list--table-row {\n  display: inline-block;\n  white-space: normal;\n  margin-bottom: 8px;\n}\n",""])},44:function(e,t,s){"use strict";function n(e){s(26)}function a(e){s(24)}function o(e){s(28)}function i(e){s(22)}Object.defineProperty(t,"__esModule",{value:!0});var r={name:"spinner",props:["show"],serverCacheKey:function(e){return e.show}},c=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("transition",[s("svg",{directives:[{name:"show",rawName:"v-show",value:e.show,expression:"show"}],staticClass:"spinner",class:{show:e.show},attrs:{width:"44px",height:"44px",viewBox:"0 0 44 44"}},[s("circle",{staticClass:"path",attrs:{fill:"none","stroke-width":"4","stroke-linecap":"round",cx:"22",cy:"22",r:"20"}})])])},l=[],d={render:c,staticRenderFns:l},u=d,m=s(1),p=n,f=m(r,u,!1,p,null,null),h=f.exports,v={components:{Spinner:h},data:function(){return{tokenList:[],destUserId:"",loading:!1,chosenDebugUser:""}},created:function(){},computed:{debugUsers:function(){return this.$store.state.debugUsers}},watch:{destUserId:function(e){e&&(this.chosenDebugUser="")},chosenDebugUser:function(e){e&&(this.destUserId="")}},asyncData:function(e){return e.store.dispatch("FETCH_DEBUG_USERS")},methods:{sendRequest:function(){var e=this;this.chosenDebugUser&&(this.destUserId=this.chosenDebugUser),console.log("retrieving token");var t="/api/tokens/"+this.destUserId;this.loading=!0,fetch(t).then(function(e){return e.json()}).then(function(t){e.loading=!1,console.log(t),"failure"===t.status?e.tokenList=[]:e.tokenList=Object.keys(t.result).map(function(e){return{token:e,type:t.result[e].type,lang:t.result[e].lang}})}).catch(function(t){e.loading=!1,console.error(t)})}}},_=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"mdc-card"},[e._m(0),s("section",{staticClass:"mdc-card__primary"},[s("form",{attrs:{action:"#"}},[s("div",[s("div",{staticClass:"mdc-form-field"},[s("div",{staticClass:"mdc-text-field",attrs:{"data-mdc-auto-init":"MDCTextField"}},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.destUserId,expression:"destUserId"}],staticClass:"mdc-text-field__input",attrs:{id:"token-dest-user-id",type:"text"},domProps:{value:e.destUserId},on:{input:function(t){t.target.composing||(e.destUserId=t.target.value)}}}),s("label",{staticClass:"mdc-text-field__label",attrs:{for:"token-dest-user-id"}},[e._v("\n              User ID\n            ")]),s("div",{staticClass:"mdc-text-field__bottom-line"})])])])])]),s("hr",{staticClass:"mdc-list-divider separating-line"}),s("section",{staticClass:"mdc-card__primary"},[s("form",{attrs:{action:"#"}},[e._v("\n      OR pick a debug User ID:\n      "),s("div",{staticClass:"mdc-select"},[s("select",{directives:[{name:"model",rawName:"v-model",value:e.chosenDebugUser,expression:"chosenDebugUser"}],staticClass:"mdc-select__surface",on:{change:function(t){var s=Array.prototype.filter.call(t.target.options,function(e){return e.selected}).map(function(e){return"_value"in e?e._value:e.value});e.chosenDebugUser=t.target.multiple?s:s[0]}}},[s("option",{attrs:{value:""}},[e._v("Choose...")]),e._l(e.debugUsers,function(t){return s("option",{domProps:{value:t.userId}},[e._v(e._s(t.username))])})],2),s("div",{staticClass:"mdc-select__bottom-line"})])])]),s("hr",{staticClass:"mdc-list-divider separating-line"}),s("section",{staticClass:"mdc-card__primary"},[e._v("\n    fetch('https://iceicebaby.com/api/tokens/"+e._s(e.destUserId||e.chosenDebugUser)+"')\n  ")]),s("section",{directives:[{name:"show",rawName:"v-show",value:e.tokenList.length>0||e.loading,expression:"tokenList.length > 0 || loading"}],staticClass:"mdc-card__supporting-text"},[s("Spinner",{attrs:{show:e.loading}}),s("ul",{staticClass:"mdc-list mdc-list--two-line mdc-list--dense demo-list token-list--table-body"},e._l(e.tokenList,function(t){return s("li",{staticClass:"mdc-list-item token-list--table-row token--wrap-text"},[s("span",{staticClass:"mdc-list-item__text"},[e._v("\n          "+e._s(t.type)+" ("+e._s(t.lang)+")\n          "),s("span",{staticClass:"mdc-list-item__secondary-text"},[e._v(e._s(t.token))])])])}))],1),s("section",{staticClass:"mdc-card__actions"},[s("button",{staticClass:"mdc-button mdc-button--compact mdc-card__action",on:{click:function(t){e.sendRequest()}}},[e._v("Punch It!")])])])},g=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("section",{staticClass:"mdc-card__primary"},[s("h1",{staticClass:"mdc-card__title mdc-card__title--large"},[e._v("Get List of Tokens")]),s("h2",{staticClass:"mdc-card__subtitle"},[e._v("Retrieve list of tokens depending on User ID")])])}],k={render:_,staticRenderFns:g},b=k,w=s(1),y=a,C=w(v,b,!1,y,null,null),x=C.exports,U={data:function(){return{tokenList:[],destUserId:"",loading:!0,chosenDebugUser:"",chosenLang:"",availableLang:["zh-hk","en"],hasToken:!1}},created:function(){},computed:{debugUsers:function(){return this.$store.state.debugUsers}},watch:{destUserId:function(e){e&&(this.chosenDebugUser="")},chosenDebugUser:function(e){e&&(this.destUserId="")}},asyncData:function(e){return e.store.dispatch("FETCH_DEBUG_USERS")},methods:{retrieveToken:function(){var e=this,t=firebase.messaging();this.chosenLang&&(this.destUserId||this.chosenDebugUser)&&(this.chosenDebugUser&&(this.destUserId=this.chosenDebugUser),navigator.serviceWorker.register("/service-worker.js").then(function(s){t.useServiceWorker(s),t.getToken().then(function(t){if(t){console.log("get token!"),console.log(t);var s={token:t,userId:e.destUserId,lang:e.chosenLang,type:"web"};fetch("/api/token",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(s)}).then(function(e){return e.json()}).then(function(s){console.log(s),"failure"===s.status?console.log("save web token failure"):(console.log("save web token success"),e.hasToken=!0,e.$store.commit("SET_DEVICE_TOKEN",t),e.$store.commit("SET_DEVICE_USER_ID",e.destUserId),localStorage.setItem("userId",e.destUserId),localStorage.setItem("token",t))})}else console.log("No Instance ID token available. Request permission to generate one.")}).catch(function(e){console.log("An error occurred while retrieving token. ",e)})}))}}},I=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"mdc-card"},[e._m(0),s("section",{directives:[{name:"show",rawName:"v-show",value:e.tokenList.length>0,expression:"tokenList.length > 0"}],staticClass:"mdc-card__supporting-text"},[e._v("\n    Hi hi\n  ")]),s("section",{staticClass:"mdc-card__primary"},[s("form",{attrs:{action:"#"}},[s("div",[s("div",{staticClass:"mdc-form-field"},[s("div",{staticClass:"mdc-text-field",attrs:{"data-mdc-auto-init":"MDCTextField"}},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.destUserId,expression:"destUserId"}],staticClass:"mdc-text-field__input",attrs:{id:"token-dest-user-id",type:"text"},domProps:{value:e.destUserId},on:{input:function(t){t.target.composing||(e.destUserId=t.target.value)}}}),s("label",{staticClass:"mdc-text-field__label",attrs:{for:"token-dest-user-id"}},[e._v("\n              User ID\n            ")]),s("div",{staticClass:"mdc-text-field__bottom-line"})])])])])]),s("section",{staticClass:"mdc-card__primary"},[s("form",{attrs:{action:"#"}},[e._v("\n      OR pick a debug User ID:\n      "),s("div",{staticClass:"mdc-select"},[s("select",{directives:[{name:"model",rawName:"v-model",value:e.chosenDebugUser,expression:"chosenDebugUser"}],staticClass:"mdc-select__surface",on:{change:function(t){var s=Array.prototype.filter.call(t.target.options,function(e){return e.selected}).map(function(e){return"_value"in e?e._value:e.value});e.chosenDebugUser=t.target.multiple?s:s[0]}}},[s("option",{attrs:{value:""}},[e._v("Choose...")]),e._l(e.debugUsers,function(t){return s("option",{domProps:{value:t.userId}},[e._v(e._s(t.username))])})],2),s("div",{staticClass:"mdc-select__bottom-line"})])])]),s("hr",{staticClass:"mdc-list-divider separating-line"}),s("section",{staticClass:"mdc-card__primary"},[s("form",{attrs:{action:"#"}},[e._v("\n      Choose Language:\n      "),s("div",{staticClass:"mdc-select"},[s("select",{directives:[{name:"model",rawName:"v-model",value:e.chosenLang,expression:"chosenLang"}],staticClass:"mdc-select__surface",on:{change:function(t){var s=Array.prototype.filter.call(t.target.options,function(e){return e.selected}).map(function(e){return"_value"in e?e._value:e.value});e.chosenLang=t.target.multiple?s:s[0]}}},[s("option",{attrs:{value:""}},[e._v("Choose...")]),e._l(e.availableLang,function(t){return s("option",{domProps:{value:t}},[e._v(e._s(t))])})],2),s("div",{staticClass:"mdc-select__bottom-line"})])])]),s("hr",{staticClass:"mdc-list-divider separating-line"}),s("section",{directives:[{name:"show",rawName:"v-show",value:e.tokenList.length>0,expression:"tokenList.length > 0"}],staticClass:"mdc-card__supporting-text"},[s("ul",{staticClass:"mdc-list token-list--table-body"},e._l(e.tokenList,function(t){return s("li",{staticClass:"mdc-list-item token-list--table-row token--wrap-text"},[e._v("\n        "+e._s(t)+"\n      ")])}))]),s("section",{staticClass:"mdc-card__actions"},[s("button",{staticClass:"mdc-button mdc-button--compact mdc-card__action",on:{click:function(t){e.retrieveToken()}}},[e._v("Punch It!")])])])},D=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("section",{staticClass:"mdc-card__primary"},[s("h1",{staticClass:"mdc-card__title mdc-card__title--large"},[e._v("Get Token for Device")]),s("h2",{staticClass:"mdc-card__subtitle"},[e._v("Get token for your device (web only)")])])}],L={render:I,staticRenderFns:D},T=L,E=s(1),S=o,N=E(U,T,!1,S,null,null),R=N.exports,$={name:"token-page",mounted:function(){console.log("token page mounted")},computed:{hasToken:function(){return""!==this.$store.state.deviceToken}},components:{Token:R,TokenList:x}},P=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"demo-grid mdc-layout-grid"},[s("div",{staticClass:"mdc-layout-grid__inner"},[s("div",{directives:[{name:"show",rawName:"v-show",value:!e.hasToken,expression:"!hasToken"}],staticClass:"demo-cell mdc-layout-grid__cell mdc-layout-grid__cell--span-6 mdc-layout-grid__cell--span-8-tablet"},[s("Token")],1),s("div",{staticClass:"demo-cell mdc-layout-grid__cell mdc-layout-grid__cell--span-6 mdc-layout-grid__cell--span-8-tablet"},[s("TokenList")],1)])])},F=[],j={render:P,staticRenderFns:F},O=j,A=s(1),G=i,q=A($,O,!1,G,null,null);t.default=q.exports}});