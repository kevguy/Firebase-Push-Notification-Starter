webpackJsonp([0],{21:function(t,e,s){var n=s(22);"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);s(3)("644b28a4",n,!0)},22:function(t,e,s){e=t.exports=s(2)(void 0),e.push([t.i,"",""])},23:function(t,e,s){var n=s(24);"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);s(3)("5652ccd3",n,!0)},24:function(t,e,s){e=t.exports=s(2)(void 0),e.push([t.i,"\n.separating-line {\n  border-bottom-color: rgba(0, 0, 0, 0.12);\n}\n.token--wrap-text {\n  overflow-wrap: break-word;\n}\n.token--wrap-text span {\n    max-width: 100%;\n}\n.token-list--table-body {\n  overflow-y: auto;\n  overflow-x: hidden;\n  max-height: 300px;\n  display: grid;\n  max-width: 100%;\n}\n.token-list--table-row {\n  display: inline-block;\n  white-space: normal;\n  margin-bottom: 8px;\n}\n",""])},25:function(t,e,s){var n=s(26);"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);s(3)("dcfe3e92",n,!0)},26:function(t,e,s){e=t.exports=s(2)(void 0),e.push([t.i,".spinner{-webkit-transition:opacity .15s ease;-o-transition:opacity .15s ease;transition:opacity .15s ease;-webkit-animation:rotator 1.4s linear infinite;animation:rotator 1.4s linear infinite;-webkit-animation-play-state:paused;animation-play-state:paused}.spinner.show{-webkit-animation-play-state:running;animation-play-state:running}.spinner.v-enter,.spinner.v-leave-active{opacity:0}.spinner.v-enter-active,.spinner.v-leave{opacity:1}.spinner .path{stroke:#f60;stroke-dasharray:126;stroke-dashoffset:0;-webkit-transform-origin:center;-ms-transform-origin:center;transform-origin:center;-webkit-animation:dash 1.4s ease-in-out infinite;animation:dash 1.4s ease-in-out infinite}@-webkit-keyframes rotator{0%{-webkit-transform:scale(.5) rotate(0deg);transform:scale(.5) rotate(0deg)}to{-webkit-transform:scale(.5) rotate(270deg);transform:scale(.5) rotate(270deg)}}@keyframes rotator{0%{-webkit-transform:scale(.5) rotate(0deg);transform:scale(.5) rotate(0deg)}to{-webkit-transform:scale(.5) rotate(270deg);transform:scale(.5) rotate(270deg)}}@-webkit-keyframes dash{0%{stroke-dashoffset:126}50%{stroke-dashoffset:63;-webkit-transform:rotate(135deg);transform:rotate(135deg)}to{stroke-dashoffset:126;-webkit-transform:rotate(450deg);transform:rotate(450deg)}}@keyframes dash{0%{stroke-dashoffset:126}50%{stroke-dashoffset:63;-webkit-transform:rotate(135deg);transform:rotate(135deg)}to{stroke-dashoffset:126;-webkit-transform:rotate(450deg);transform:rotate(450deg)}}",""])},27:function(t,e,s){var n=s(28);"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);s(3)("55a803a4",n,!0)},28:function(t,e,s){e=t.exports=s(2)(void 0),e.push([t.i,"\n.separating-line {\n  border-bottom-color: rgba(0, 0, 0, 0.12);\n}\n.token--wrap-text {\n  overflow-wrap: break-word;\n}\n.token-list--table-body {\n  overflow-y: auto;\n  overflow-x: hidden;\n  max-height: 300px;\n  display: grid;\n  max-width: 100%;\n}\n.token-list--table-row {\n  display: inline-block;\n  white-space: normal;\n  margin-bottom: 8px;\n}\n",""])},43:function(t,e,s){"use strict";function n(t){s(25)}function a(t){s(23)}function o(t){s(27)}function i(t){s(21)}Object.defineProperty(e,"__esModule",{value:!0});var r={name:"spinner",props:["show"],serverCacheKey:function(t){return t.show}},c=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("transition",[s("svg",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"show"}],staticClass:"spinner",class:{show:t.show},attrs:{width:"44px",height:"44px",viewBox:"0 0 44 44"}},[s("circle",{staticClass:"path",attrs:{fill:"none","stroke-width":"4","stroke-linecap":"round",cx:"22",cy:"22",r:"20"}})])])},l=[],d={render:c,staticRenderFns:l},u=d,m=s(1),p=n,f=m(r,u,!1,p,null,null),h=f.exports,v={components:{Spinner:h},data:function(){return{tokenList:[],destUserId:"",loading:!1,chosenDebugUser:""}},created:function(){},computed:{debugUsers:function(){return this.$store.state.debugUsers}},watch:{destUserId:function(t){t&&(this.chosenDebugUser="")},chosenDebugUser:function(t){t&&(this.destUserId="")}},asyncData:function(t){return t.store.dispatch("FETCH_DEBUG_USERS")},methods:{sendRequest:function(){var t=this;this.chosenDebugUser&&(this.destUserId=this.chosenDebugUser),console.log("retrieving token");var e="/api/tokens/"+this.destUserId;this.loading=!0,fetch(e).then(function(t){return t.json()}).then(function(e){t.loading=!1,console.log(e),"failure"===e.status?t.tokenList=[]:t.tokenList=Object.keys(e.result).map(function(t){return{token:t,type:e.result[t].type,lang:e.result[t].lang}})}).catch(function(e){t.loading=!1,console.error(e)})}}},_=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"mdc-card"},[t._m(0),s("section",{staticClass:"mdc-card__primary"},[s("form",{attrs:{action:"#"}},[s("div",[s("div",{staticClass:"mdc-form-field"},[s("div",{staticClass:"mdc-text-field",attrs:{"data-mdc-auto-init":"MDCTextField"}},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.destUserId,expression:"destUserId"}],staticClass:"mdc-text-field__input",attrs:{id:"token-dest-user-id",type:"text"},domProps:{value:t.destUserId},on:{input:function(e){e.target.composing||(t.destUserId=e.target.value)}}}),s("label",{staticClass:"mdc-text-field__label",attrs:{for:"token-dest-user-id"}},[t._v("\n              User ID\n            ")]),s("div",{staticClass:"mdc-text-field__bottom-line"})])])])])]),s("hr",{staticClass:"mdc-list-divider separating-line"}),s("section",{staticClass:"mdc-card__primary"},[s("form",{attrs:{action:"#"}},[t._v("\n      OR pick a debug User ID:\n      "),s("div",{staticClass:"mdc-select"},[s("select",{directives:[{name:"model",rawName:"v-model",value:t.chosenDebugUser,expression:"chosenDebugUser"}],staticClass:"mdc-select__surface",on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.chosenDebugUser=e.target.multiple?s:s[0]}}},[s("option",{attrs:{value:""}},[t._v("Choose...")]),t._l(t.debugUsers,function(e){return s("option",{domProps:{value:e.userId}},[t._v(t._s(e.username))])})],2),s("div",{staticClass:"mdc-select__bottom-line"})])])]),s("hr",{staticClass:"mdc-list-divider separating-line"}),s("section",{staticClass:"mdc-card__primary"},[t._v("\n    fetch('https://iceicebaby.com/api/tokens/"+t._s(t.destUserId||t.chosenDebugUser)+"')\n  ")]),s("section",{directives:[{name:"show",rawName:"v-show",value:t.tokenList.length>0||t.loading,expression:"tokenList.length > 0 || loading"}],staticClass:"mdc-card__supporting-text"},[s("Spinner",{attrs:{show:t.loading}}),s("ul",{staticClass:"mdc-list mdc-list--two-line mdc-list--dense demo-list token-list--table-body"},t._l(t.tokenList,function(e){return s("li",{staticClass:"mdc-list-item token-list--table-row token--wrap-text"},[s("span",{staticClass:"mdc-list-item__text"},[t._v("\n          "+t._s(e.type)+" ("+t._s(e.lang)+")\n          "),s("span",{staticClass:"mdc-list-item__secondary-text"},[t._v(t._s(e.token))])])])}))],1),s("section",{staticClass:"mdc-card__actions"},[s("button",{staticClass:"mdc-button mdc-button--compact mdc-card__action",on:{click:function(e){t.sendRequest()}}},[t._v("Punch It!")])])])},g=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("section",{staticClass:"mdc-card__primary"},[s("h1",{staticClass:"mdc-card__title mdc-card__title--large"},[t._v("Get List of Tokens")]),s("h2",{staticClass:"mdc-card__subtitle"},[t._v("Retrieve list of tokens depending on User ID")])])}],k={render:_,staticRenderFns:g},b=k,w=s(1),y=a,C=w(v,b,!1,y,null,null),x=C.exports,U={data:function(){return{tokenList:[],destUserId:"",loading:!0,chosenDebugUser:"",chosenLang:"",availableLang:["zh-hk","en"],hasToken:!1}},created:function(){},computed:{debugUsers:function(){return this.$store.state.debugUsers}},watch:{destUserId:function(t){t&&(this.chosenDebugUser="")},chosenDebugUser:function(t){t&&(this.destUserId="")}},asyncData:function(t){return t.store.dispatch("FETCH_DEBUG_USERS")},methods:{retrieveToken:function(){var t=this,e=firebase.messaging();this.chosenLang&&(this.destUserId||this.chosenDebugUser)&&(this.chosenDebugUser&&(this.destUserId=this.chosenDebugUser),navigator.serviceWorker.register("/service-worker.js").then(function(s){e.useServiceWorker(s),e.getToken().then(function(e){if(e){console.log("get token!"),console.log(e);var s={token:e,userId:t.destUserId,lang:t.chosenLang,type:"web"};fetch("/api/token",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(s)}).then(function(t){return t.json()}).then(function(s){console.log(s),"failure"===s.status?console.log("save web token failure"):(console.log("save web token success"),t.hasToken=!0,t.$store.commit("SET_DEVICE_TOKEN",e),t.$store.commit("SET_DEVICE_USER_ID",t.destUserId),localStorage.setItem("userId",t.destUserId),localStorage.setItem("token",e))})}else console.log("No Instance ID token available. Request permission to generate one.")}).catch(function(t){console.log("An error occurred while retrieving token. ",t)})}))}}},I=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"mdc-card"},[t._m(0),s("section",{directives:[{name:"show",rawName:"v-show",value:t.tokenList.length>0,expression:"tokenList.length > 0"}],staticClass:"mdc-card__supporting-text"},[t._v("\n    Hi hi\n  ")]),s("section",{staticClass:"mdc-card__primary"},[s("form",{attrs:{action:"#"}},[s("div",[s("div",{staticClass:"mdc-form-field"},[s("div",{staticClass:"mdc-text-field",attrs:{"data-mdc-auto-init":"MDCTextField"}},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.destUserId,expression:"destUserId"}],staticClass:"mdc-text-field__input",attrs:{id:"token-dest-user-id",type:"text"},domProps:{value:t.destUserId},on:{input:function(e){e.target.composing||(t.destUserId=e.target.value)}}}),s("label",{staticClass:"mdc-text-field__label",attrs:{for:"token-dest-user-id"}},[t._v("\n              User ID\n            ")]),s("div",{staticClass:"mdc-text-field__bottom-line"})])])])])]),s("section",{staticClass:"mdc-card__primary"},[s("form",{attrs:{action:"#"}},[t._v("\n      OR pick a debug User ID:\n      "),s("div",{staticClass:"mdc-select"},[s("select",{directives:[{name:"model",rawName:"v-model",value:t.chosenDebugUser,expression:"chosenDebugUser"}],staticClass:"mdc-select__surface",on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.chosenDebugUser=e.target.multiple?s:s[0]}}},[s("option",{attrs:{value:""}},[t._v("Choose...")]),t._l(t.debugUsers,function(e){return s("option",{domProps:{value:e.userId}},[t._v(t._s(e.username))])})],2),s("div",{staticClass:"mdc-select__bottom-line"})])])]),s("hr",{staticClass:"mdc-list-divider separating-line"}),s("section",{staticClass:"mdc-card__primary"},[s("form",{attrs:{action:"#"}},[t._v("\n      Choose Language:\n      "),s("div",{staticClass:"mdc-select"},[s("select",{directives:[{name:"model",rawName:"v-model",value:t.chosenLang,expression:"chosenLang"}],staticClass:"mdc-select__surface",on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.chosenLang=e.target.multiple?s:s[0]}}},[s("option",{attrs:{value:""}},[t._v("Choose...")]),t._l(t.availableLang,function(e){return s("option",{domProps:{value:e}},[t._v(t._s(e))])})],2),s("div",{staticClass:"mdc-select__bottom-line"})])])]),s("hr",{staticClass:"mdc-list-divider separating-line"}),s("section",{directives:[{name:"show",rawName:"v-show",value:t.tokenList.length>0,expression:"tokenList.length > 0"}],staticClass:"mdc-card__supporting-text"},[s("ul",{staticClass:"mdc-list token-list--table-body"},t._l(t.tokenList,function(e){return s("li",{staticClass:"mdc-list-item token-list--table-row token--wrap-text"},[t._v("\n        "+t._s(e)+"\n      ")])}))]),s("section",{staticClass:"mdc-card__actions"},[s("button",{staticClass:"mdc-button mdc-button--compact mdc-card__action",on:{click:function(e){t.retrieveToken()}}},[t._v("Punch It!")])])])},D=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("section",{staticClass:"mdc-card__primary"},[s("h1",{staticClass:"mdc-card__title mdc-card__title--large"},[t._v("Get Token for Device")]),s("h2",{staticClass:"mdc-card__subtitle"},[t._v("Get token for your device (web only)")])])}],L={render:I,staticRenderFns:D},T=L,E=s(1),S=o,N=E(U,T,!1,S,null,null),R=N.exports,$={name:"token-page",computed:{hasToken:function(){return""!==this.$store.state.deviceToken}},components:{Token:R,TokenList:x}},P=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"demo-grid mdc-layout-grid"},[s("div",{staticClass:"mdc-layout-grid__inner"},[s("div",{directives:[{name:"show",rawName:"v-show",value:!t.hasToken,expression:"!hasToken"}],staticClass:"demo-cell mdc-layout-grid__cell mdc-layout-grid__cell--span-6 mdc-layout-grid__cell--span-8-tablet"},[s("Token")],1),s("div",{staticClass:"demo-cell mdc-layout-grid__cell mdc-layout-grid__cell--span-6 mdc-layout-grid__cell--span-8-tablet"},[s("TokenList")],1)])])},F=[],j={render:P,staticRenderFns:F},O=j,A=s(1),G=i,q=A($,O,!1,G,null,null);e.default=q.exports}});