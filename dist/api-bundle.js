module.exports=function(e){function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}var t={};return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},n.p="/dist/",n(n.s=10)}([function(e,n){e.exports=require("rxjs/Rx")},function(e,n){e.exports=require("firebase/auth")},function(e,n){e.exports=require("firebase/app")},function(e,n){e.exports=require("firebase/database")},function(e,n){e.exports=require("isomorphic-fetch")},function(e,n){e.exports=require("firebase/messaging")},function(e,n){e.exports=require("mongoose")},function(e,n){e.exports=require("googleapis")},function(e,n){e.exports=require("bcrypt-nodejs")},function(e,n){e.exports=require("jsonwebtoken")},function(e,n,t){"use strict";function r(e){return 0===C.apps.length&&(console.log(e),C.initializeApp(e)),C.database()}function o(){return{apiKey:process.env.FIREBASE_API_KEY,authDomain:process.env.FIREBASE_DOMAIN_KEY,databaseURL:process.env.FIREBASE_DATABASE_URL,projectId:process.env.FIREBASE_PROJECT_ID,storageBucket:process.env.FIREBASE_STORAGE_BUCKET,messagingSenderId:process.env.FIREBASE_MESSAGING_SENDER_ID}}function i(){return{type:"service_account",project_id:"kevchat-a5b6f",private_key_id:"dc4806e84c1c43064e683884b9e62a2bb12e3319",private_key:"-----BEGIN PRIVATE KEY-----\nMIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQDU4J75tKyjWSQX\nWL4qww8i6xW51NTEdxxZXmYt3WuYpCpfFzpYU40KggPsTGl55cqzoOY3Py7g1mjm\nbTwCAujc7w2ceQnoAodZmQy9V8q3ygb+1rtNjjQF0SIAN3eoYbrXBfNYAhlrZS3G\n8mTJdvbsBsfYXn+NbazXzIvEuI2RZyRZkMtLNd+LklCfF9dIGX9Z/hyRIikqYt49\npanK8iTBI/ux6W62RPIfpuPWvUCdabVOJTfZ19qJLsi3S5kzqRTwzeTFU+fa3SUv\n9cUBdnmWEgfmWo9I8/6s+Hdt5R+QkrrMgfn0DOd0HD5x5zkwAdS+Sk87eVCOtUny\nb9zlofFNAgMBAAECggEAXFJwT95eEte5kdCAZN5EpcGrofTeM7humImaqeCB5eio\noaXavWy62ehKGESJZ/7TOrUYsrQZuhPy2aBdKoglgo/AaPCLbc4O8jowrrsw5SVe\nhE4PXFLEWBN7efmUUPfVhqSDhVMfwBZY1JPSRxdrfjBwonNVQTpkABErOq1JZFm6\nt2qHNFDMspwhYrbChYZN9Ijbvpv64XiejYM/rP/+Dpb5o1LwpyL6vJ8Z0xj9g65l\ncQZcITXgdi+lQDzbCR9sQ+2n/xlMiutFTsFqhL6giuQcNU/eD0l6wp4wPj8PqRMr\n3fLgPdErdTlB7rYPo1No3fuGAoz8yo9UpwLykjhCdwKBgQD3EmrJ6CHueyNqj7ek\nlHivjdSbyxjCeMwur5M1w+dqKBwDXAOtQ+sBm0IZ8fZHLCxJFhlAM6ejlCZiF0O2\nij2r2lr4X8/IW2ESeOTXJx8mvuLIA0T7865GupLM6hYoztodVTUsdv3uTz2/wmlR\nPWZecz7TTVd6QvPfsaOtY2wccwKBgQDckeGkP2D6XDSo538G1vtlD+aK+EDA4XcN\nmrXrLHbaMFxwjr5/w0g14h3x6gxIJwvGe5d2CwVk4zUEcihO1d+tfgePr4vKiuAp\nKQGrO0bu0FC9smIN/1GUjHYhzIqUWHeryA8CQQTbHs0OVm5hIfhKW7RGPl24oZBK\nC7I8XnoLPwKBgQCVhEOzpBLEqygnmIldw6u1MXN0RFfbeBa4OfAwHTmx+EvbjJd9\nBxj0g+xgnxiWwZibMhBd1eShDUqdGc8UbFwd36olnHW1nfcEorx5p2cmn2XF/JSG\nlFTm4IluEEsQrv03uxTOr8PDr5iCrzfkve9xQPTIEonZpyLGQE34463NGQKBgFkb\nZjjgkeES1wNVYm/08eLGJbEG0cIaU+pfEhdMA0fqOa4PPM6Iqed6zfYpQ4TyoUMy\nMuIxWaCEWarOI5KVvKNuQse9d4//wsdeFZqDfAiGh9fa9NoKx35nsGG/LEz54H65\nd7bFZZzQOK8OI9GB07jWi2HFWD96pbwENaFF2bApAoGBANUnVJxW0fJMh/9sYwQH\nmedP7aV7nLIFdG988p53wdvQN7CF40wCOckvW/bG/I83a7dibSj274EYSIa1deWb\nCWS+UsiNqMKgQgtzk4Id4AmLF0AVksJKH36+cP2PLexNdocL4Ku9T71IqsZn0JvC\nWaIK9klqvoH0aLg5XOJw5Zyg\n-----END PRIVATE KEY-----\n",client_email:"firebase-adminsdk-7fhc2@kevchat-a5b6f.iam.gserviceaccount.com",client_id:"112694782557192835677",auth_uri:"https://accounts.google.com/o/oauth2/auth",token_uri:"https://accounts.google.com/o/oauth2/token",auth_provider_x509_cert_url:"https://www.googleapis.com/oauth2/v1/certs",client_x509_cert_url:"https://www.googleapis.com/robot/v1/metadata/x509/firebase-adminsdk-7fhc2%40kevchat-a5b6f.iam.gserviceaccount.com"}}function s(e){return 0===C.apps.length&&C.initializeApp(e),C.auth().signInWithEmailAndPassword(process.env.FIREBASE_EMAIL,process.env.FIREBASE_PASSWORD).catch(function(e){var n=e.code,t=e.message;return console.error("Sign in failed ("+n+"): "+t),e})}function u(e){return Q(this,void 0,void 0,function(){var n,t,r,o,i;return U(this,function(s){switch(s.label){case 0:return n=e.userId,t=e.token,r=e.lang,console.log("createNotificationKey "),o="zh-hk"===r?"zh_hk":"en",[4,L("https://android.googleapis.com/gcm/notification",{method:"POST",headers:new Headers({"Content-Type":"application/json",Authorization:"key="+process.env.FIREBASE_SERVER_KEY,project_id:process.env.FIREBASE_MESSAGING_SENDER_ID}),body:JSON.stringify({operation:"create",notification_key_name:n+"_"+o,registration_ids:[t]})}).then(function(e){return e.json()}).catch(function(e){console.error("userGroups: failed to create notification key: "+e)})];case 1:return i=s.sent(),console.log("notification key is: "+i),console.log(i),console.log(n+"_"+o),[2,i.notification_key]}})})}function a(e){return Q(this,void 0,void 0,function(){var n,t,r,o;return U(this,function(i){switch(i.label){case 0:return n=e.userId,t=e.lang,console.log("inside retrieveNotificationKey"),r="zh-hk"===t?"zh_hk":"en",[4,L("https://android.googleapis.com/gcm/notification?notification_key_name="+n+"_"+r,{method:"GET",headers:new Headers({"Content-Type":"application/json",Authorization:"key="+process.env.FIREBASE_SERVER_KEY,project_id:process.env.FIREBASE_MESSAGING_SENDER_ID}),body:JSON.stringify({})}).then(function(e){return e.json()}).then(function(e){if(e.error)throw new Error(e.error);return e}).catch(function(e){console.error("userGroups: failed to retrieve notification key from userId "+n+": "+e)})];case 1:return o=i.sent(),console.info(o),o?[2,o.notification_key]:[2,!1]}})})}function c(e,n){return Q(this,void 0,void 0,function(){var t,i,c,f,l,d,p,h,v;return U(this,function(g){switch(g.label){case 0:return t=n.userId,i=n.token,c=n.lang,f=n.type,console.log(i),l="zh-hk"===c?"zh_hk":"en",[4,a(n)];case 1:return d=g.sent(),console.log("retrieveNotificationKey: "+d),d?[3,3]:[4,u(n)];case 2:return d=g.sent(),[3,5];case 3:return console.log(e+"ing token to device group"),[4,L("https://android.googleapis.com/gcm/notification",{method:"POST",headers:new Headers({"Content-Type":"application/json",Authorization:"key="+process.env.FIREBASE_SERVER_KEY,project_id:process.env.FIREBASE_MESSAGING_SENDER_ID}),body:JSON.stringify({operation:e,notification_key_name:t+"_"+l,notification_key:d,registration_ids:[i]})}).then(function(e){return e.text()}).then(function(e){if(console.log(e),JSON.parse(e).error)throw new Error(e);return e}).catch(function(n){console.error("userGroups: failed to "+e+" token "+i+" to notification key: "+d),console.log(n)})];case 4:d=g.sent(),g.label=5;case 5:return d?(console.log("saving stuff to database"),p=r(o()),[4,s(o())]):[3,8];case 6:return h=g.sent(),console.log("signed in"),v=p.ref("deviceGroup/"+t+"_"+l).push(),console.log("saving stuff to database"),[4,p.ref("deviceGroup/"+t+"_"+l+"/"+v.key).set({type:f,token:i})];case 7:g.sent(),g.label=8;case 8:return[2,d]}})})}function f(e){return Q(this,void 0,void 0,function(){return U(this,function(n){switch(n.label){case 0:return[4,c("add",e)];case 1:return[2,n.sent()]}})})}function l(e){return Q(this,void 0,void 0,function(){return U(this,function(n){switch(n.label){case 0:return[4,c("remove",e)];case 1:return[2,n.sent()]}})})}function d(e,n){return Y(this,void 0,void 0,function(){var t;return W(this,function(r){switch(r.label){case 0:return[4,L("https://fcm.googleapis.com/fcm/send",{method:"POST",headers:new Headers({"Content-Type":"application/json",Authorization:"key="+process.env.FIREBASE_SERVER_KEY,project_id:process.env.FIREBASE_SERVER_KEY}),body:JSON.stringify({to:e,notification:n})}).then(function(e){return e.json()}).then(function(e){if(e.error)throw new Error(e);return e})];case 1:return t=r.sent(),[2,t]}})})}function p(e){var n=(r(o()),{title:e.title,body:e.message}),t={userId:e.userId,lang:e.lang};return K.Observable.fromPromise(a(t)).flatMap(function(e){return console.info("found notification id: "+e),K.Observable.fromPromise(d(e,n))}).flatMap(function(e){return K.Observable.of(Z({},e,{status:"success"}))})}function h(e,n,t,r){var o;p(e).subscribe(function(e){o={status:"success",result:e}},function(e){o={status:"failure",result:e},t.send(JSON.stringify(o))},function(){console.info(o),t.send(JSON.stringify(o))})}function v(){return new Promise(function(e,n){var t=i();new H.auth.JWT(t.client_email,void 0,t.private_key,V,void 0).authorize(function(t,r){if(t)return void n(t);console.log("fuck"),console.log(r),e(r.access_token)})})}function g(e,n){return X(this,void 0,void 0,function(){var t,r;return $(this,function(o){switch(o.label){case 0:return[4,v()];case 1:return t=o.sent(),console.log(t),r=L(process.env.FIREBASE_PUSH_NOTIFICATION_WEB,{method:"POST",headers:new Headers({"Content-Type":"application/json",Authorization:"Bearer "+t}),body:JSON.stringify({message:{token:e,notification:n}})}).then(function(e){return e.json()}).then(function(e){if(console.log(e),e.error)throw new Error(e)}).catch(function(e){console.error(e)}),[2,r]}})})}function b(e,n){return X(this,void 0,void 0,function(){return $(this,function(e){return[2,"foo"]})})}function y(e,n){return X(this,void 0,void 0,function(){return $(this,function(e){return[2,"foo"]})})}function m(e,n,t){return X(this,void 0,void 0,function(){var r;return $(this,function(o){switch(o.label){case 0:switch(r=e){case"web":return[3,1];case"android":return[3,3];case"ios":return[3,5]}return[3,7];case 1:return[4,g(n,t)];case 2:return[2,o.sent()];case 3:return[4,b(n,t)];case 4:return[2,o.sent()];case 5:return[4,y(n,t)];case 6:return[2,o.sent()];case 7:return[2]}})})}function w(e){var n={title:e.title,body:e.message};return K.Observable.fromPromise(m(e.type,e.token,n)).flatMap(function(){return K.Observable.of({status:"success",msg:"message sent to token "+e.token})})}function k(e,n,t,r){var o;w(e).subscribe(function(e){o={status:"success",result:e}},function(e){o={status:"failure",result:e}},function(){console.info(o),t.send(JSON.stringify(o))})}function I(e,n){return ee(this,void 0,void 0,function(){var t,r;return ne(this,function(i){switch(i.label){case 0:return[4,s(o())];case 1:return t=i.sent(),[4,e.ref("/users/"+n).once("value")];case 2:return r=i.sent(),[2,r.val()]}})})}function E(e){return K.Observable.create(function(n){ie.findOneAndUpdate({token:e.token},e,{upsert:!0,new:!0},function(e,t){e&&(console.log(e),n.error({status:"failure",msg:"database error"})),n.next({status:"success",msg:"token saved",result:t}),n.complete()})})}function _(e){return K.Observable.create(function(n){ie.findOne({token:e},function(e,t){e&&(console.log(e),n.error({status:"failure",msg:"database error"})),n.next(t),n.complete()})})}function S(e){return K.Observable.create(function(n){ae.find({userId:e},function(e,t){e&&n.error({status:"failure",msg:"database error",err:e});var r=t.map(function(e){return e.deviceGroup});n.next(r),n.complete()})})}function O(e){return K.Observable.create(function(n){ae.findOne({deviceGroup:e},function(e,t){e&&n.error({status:"failure",msg:"database error",err:e}),n.next(t.tokens),n.complete()})}).flatMap(function(e){if(e){var n=e.map(function(e){return _(e)});return K.Observable.merge.apply(K.Observable,n).reduce(function(e,n){return e.concat([n])},[])}return K.Observable.of([])})}function x(e,n){return O(n).flatMap(function(t){if(console.log("in checkTokenFromDeviceGroupStream flatmap"),console.log(t),t.length>0){return t.map(function(e){return e.token}).indexOf(e)>=0?K.Observable.of({deviceGroup:n,found:!0}):K.Observable.of({deviceGroup:n,found:!1})}return K.Observable.of({deviceGroup:n,found:!1})})}function A(e){return K.Observable.create(function(n){ae.findOne({deviceGroup:e.deviceGroup},function(t,r){t&&n.error({status:"failure",msg:"database error",err:t});var o;if(r){var i=r.tokens.concat([e.token]).reduce(function(e,n){return e.indexOf(n)<0&&e.push(n),e},[]);o={deviceGroup:r.deviceGroup,userId:r.userId,tokens:i}}else o={deviceGroup:e.deviceGroup,userId:e.userId,tokens:[e.token]};ae.findOneAndUpdate({deviceGroup:e.deviceGroup},o,{upsert:!0,new:!0},function(t,r){t&&n.error({status:"failure",msg:"database error",err:t}),n.next({status:"success",msg:"token saved to device group "+e.deviceGroup,result:r}),n.complete()})})})}function G(e){return K.Observable.create(function(n){ae.findOne({deviceGroup:e.deviceGroup},function(t,r){t&&n.error({status:"failure",msg:"database error",err:t}),r||n.error({status:"failure",msg:"record not found"});var o;1===r.tokens.length?ae.remove({deviceGroup:e.deviceGroup},function(t){t&&n.error({status:"failure",msg:"database error",err:t}),n.next({status:"success",msg:"token deleted from device group "+e.deviceGroup})}):(o={deviceGroup:r.deviceGroup,userId:r.userId,tokens:r.tokens.filter(function(n){return n!==e.token})},ae.findOneAndUpdate({deviceGroup:e.deviceGroup},o,{upsert:!0,new:!0},function(t,r){t&&n.error({status:"failure",msg:"database error",err:t}),n.next({status:"success",msg:"token deleted from device group "+e.deviceGroup}),n.complete()}))})})}function N(e){return console.log(e),K.Observable.fromPromise(f(e)).flatMap(function(e){return K.Observable.of({status:"success",msg:"created notification key successfully",notification_key:e})}).do(function(){console.log("created notification key")})}function T(e,n,t,r){var o=(e.userId,e.token,e.lang,{status:"success",result:[]}),i="zh-hk"===e.lang?"zh_hk":"en",s=e.userId+"_"+i,u=N(e),a=E(e),c=A({deviceGroup:s,userId:e.userId,token:e.token});S(e.userId).flatMap(function(){return u}).flatMap(function(e){return K.Observable.merge(a,c)}).subscribe(function(e){o.result.push(e)},function(e){o.status="failure",o.result.push({status:"failure",result:e}),t.send(JSON.stringify(o))},function(){t.send(JSON.stringify(o))})}function P(e,n,t,i){return ce(this,void 0,void 0,function(){var n,i,s;return fe(this,function(u){switch(u.label){case 0:return i=r(o()),[4,I(i,e)];case 1:return s=u.sent(),n={status:"success",result:s},t.send(JSON.stringify(n)),[2]}})})}function B(e,n,t,r){var o={status:"success",result:[]};S(e).subscribe(function(e){o.result.push(e)},function(e){o.status="failure",o.result.push({status:"failure",result:e}),t.send(JSON.stringify(o))},function(){t.send(JSON.stringify(o))})}function R(e,n,t,r){var o={status:"success",result:""};O(e).subscribe(function(e){o.result=e},function(e){o.status="failure",o.result={status:"failure",result:e},t.send(JSON.stringify(o))},function(){t.send(JSON.stringify(o))})}function F(e,n,t,r,o,i){var s,u,a="zh-hk"===t?"zh_hk":"en",c=e+"_"+a,f={status:"success",result:""};_(n).flatMap(function(e){return u=e,K.Observable.of(u)}).flatMap(function(n){return S(e)}).flatMap(function(e){if(console.log("in flat map"),console.log(e),e.length>0){var t=e.map(function(e){return x(n,e)});return K.Observable.merge.apply(K.Observable,t).filter(function(e){return console.log(e),e.found}).reduce(function(e,n){return n.found?n.deviceGroup:e},"")}return K.Observable.of("")}).flatMap(function(r){return""===r?K.Observable.throw("Original Device Group Not Found"):(s=r,K.Observable.fromPromise(l({type:u.type,lang:u.lang,token:n,userId:e})).flatMap(function(t){return console.log("after removeToken"),console.log(t),G({deviceGroup:r,userId:e,token:n})}).flatMap(function(r){console.log("after removeTokenFromDeviceGroupStream"),console.log(r);var o={type:u.type,lang:t,token:n,userId:e},i=N(o),s=E(o),a=A({deviceGroup:c,userId:e,token:n});return i.flatMap(function(e){return K.Observable.merge(s,a)})}))}).flatMap(function(e){return console.log(e),K.Observable.of({status:"success",msg:"Device Group changed from "+s+" to "+c})}).subscribe(function(e){f.result=e},function(e){f.status="failure",f.result={status:"failure",result:e},o.send(JSON.stringify(f))},function(){o.send(JSON.stringify(f))})}function M(e,n,t){var r=new he({userId:e.body.userId,password:e.body.password});he.findOne({userId:e.body.userId},function(o,i){if(o&&n.send({status:"failure",msg:"database error"}),i)return void n.send({status:"failure",msg:"Account with that userId "+e.body.userId+" already exists."});r.save(function(e){if(e)return t(e);var o=ve.sign({id:r._id},"linkinpark",{expiresIn:86400});n.send({status:"success",auth:!0,token:o})})})}function j(e,n,t){he.findOne({userId:e.body.userId},function(t,r){if(t)return n.status(500).send("Error on the server.");if(!r)return n.status(404).send("No user found.");if(!le.compareSync(e.body.password,r.password))return n.status(401).send({auth:!1,token:null});var o=ve.sign({id:r._id},"linkinpark",{expiresIn:86400});n.status(200).send({auth:!0,token:o})})}function z(e,n,t){var r=e.headers["x-access-token"];if(!r)return n.status(401).send({auth:!1,message:"No token provided."});ve.verify(r,"linkinpark",function(e,t){if(e)return n.status(500).send({auth:!1,message:"Failed to authenticate token."});n.status(200).send({auth:!0,message:"Authenticated with token!",decoded:t})})}function J(e,n,t,r){he.findOne({userId:e},function(e,n){if(e)return r(e);n?t.send({status:"found",msg:"Account with that user id already exists."}):t.send({status:"not found",msg:"Account with that user id is available."})})}function D(e){return ge(this,void 0,void 0,function(){var n,t;return be(this,function(r){return(n=e.headers["x-access-token"])?(t=new Promise(function(e,t){ve.verify(n,"linkinpark",function(n,t){n&&e(-1),e(1)})}),[2]):[2,-1]})})}function q(e){var n=this;e.use(function(e,t,r){return ge(n,void 0,void 0,function(){var n,o;return be(this,function(i){switch(i.label){case 0:return(e.url.indexOf("/user/")>=0||e.url.indexOf("/api/")>=0)&&e.url.indexOf("/user/login")<0&&e.url.indexOf("/user/signup")<0?(console.log("verifying token"),n=e.headers["x-access-token"],n?[4,new Promise(function(e,t){ve.verify(n,"linkinpark",function(n,t){n&&e(!1),e(!0)})})]:[2,t.status(401).send({auth:!1,message:"No token provided."})]):[3,2];case 1:return o=i.sent(),(console.log("finishing verifying token"),o)?(r(),[3,3]):[2,t.status(500).send({auth:!1,message:"Failed to authenticate token."})];case 2:r(),i.label=3;case 3:return[2]}})})}),e.get("/api/device-group/groups/:userId",function(e,n,t){B(e.params.userId,e,n,t)}),e.get("/api/device-group/tokens/:userId/:lang",function(e,n,t){var r="zh-hk"===e.params.lang?"zh_hk":"en";R(e.params.userId+"_"+r,e,n,t)}),e.post("/api/device-group/change-lang",function(e,n,t){var r=e.body;F(r.userId,r.token,r.targetLang,e,n,t)}),e.post("/api/direct-message",function(e,n,t){var r=e.body;k({title:r.title,message:r.message,token:r.token,type:r.type},e,n,t)}),e.post("/api/custom-message",function(e,n,t){var r=e.body;h({userId:r.userId,title:r.title,message:r.message,lang:r.lang},e,n,t)}),e.post("/api/token",function(e,n,t){console.log("handling api/token");var r=e.body;T({type:r.type,lang:r.lang,token:r.token,userId:r.userId},e,n,t)}),e.get("/api/tokens/:userId",function(e,n,t){P(e.params.userId,e,n,t)}),e.post("/user/signup",function(e,n,t){M(e,n,t)}),e.get("/user/check/:userId",function(e,n,t){J(e.params.userId,e,n,t)}),e.post("/user/login",function(e,n,t){j(e,n,t)}),e.post("/user/auth",function(e,n,t){z(e,n,t)})}Object.defineProperty(n,"__esModule",{value:!0});var K=t(0),C=t(2);t(3),t(1);global.XMLHttpRequest=t(11).XMLHttpRequest;var L=t(4),Q=this&&this.__awaiter||function(e,n,t,r){return new(t||(t=Promise))(function(o,i){function s(e){try{a(r.next(e))}catch(e){i(e)}}function u(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){e.done?o(e.value):new t(function(n){n(e.value)}).then(s,u)}a((r=r.apply(e,n||[])).next())})},U=this&&this.__generator||function(e,n){function t(e){return function(n){return r([e,n])}}function r(t){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,i&&(s=i[2&t[0]?"return":t[0]?"throw":"next"])&&!(s=s.call(i,t[1])).done)return s;switch(i=0,s&&(t=[0,s.value]),t[0]){case 0:case 1:s=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,i=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(s=a.trys,!(s=s.length>0&&s[s.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3])){a.label=t[1];break}if(6===t[0]&&a.label<s[1]){a.label=s[1],s=t;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(t);break}s[2]&&a.ops.pop(),a.trys.pop();continue}t=n.call(e,a)}catch(e){t=[6,e],i=0}finally{o=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}var o,i,s,u,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return u={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u},Y=(t(7),t(5),this&&this.__awaiter||function(e,n,t,r){return new(t||(t=Promise))(function(o,i){function s(e){try{a(r.next(e))}catch(e){i(e)}}function u(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){e.done?o(e.value):new t(function(n){n(e.value)}).then(s,u)}a((r=r.apply(e,n||[])).next())})}),W=this&&this.__generator||function(e,n){function t(e){return function(n){return r([e,n])}}function r(t){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,i&&(s=i[2&t[0]?"return":t[0]?"throw":"next"])&&!(s=s.call(i,t[1])).done)return s;switch(i=0,s&&(t=[0,s.value]),t[0]){case 0:case 1:s=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,i=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(s=a.trys,!(s=s.length>0&&s[s.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3])){a.label=t[1];break}if(6===t[0]&&a.label<s[1]){a.label=s[1],s=t;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(t);break}s[2]&&a.ops.pop(),a.trys.pop();continue}t=n.call(e,a)}catch(e){t=[6,e],i=0}finally{o=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}var o,i,s,u,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return u={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u},Z=this&&this.__assign||Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++){n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},H=t(7),V="https://www.googleapis.com/auth/firebase.messaging",X=this&&this.__awaiter||function(e,n,t,r){return new(t||(t=Promise))(function(o,i){function s(e){try{a(r.next(e))}catch(e){i(e)}}function u(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){e.done?o(e.value):new t(function(n){n(e.value)}).then(s,u)}a((r=r.apply(e,n||[])).next())})},$=this&&this.__generator||function(e,n){function t(e){return function(n){return r([e,n])}}function r(t){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,i&&(s=i[2&t[0]?"return":t[0]?"throw":"next"])&&!(s=s.call(i,t[1])).done)return s;switch(i=0,s&&(t=[0,s.value]),t[0]){case 0:case 1:s=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,i=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(s=a.trys,!(s=s.length>0&&s[s.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3])){a.label=t[1];break}if(6===t[0]&&a.label<s[1]){a.label=s[1],s=t;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(t);break}s[2]&&a.ops.pop(),a.trys.pop();continue}t=n.call(e,a)}catch(e){t=[6,e],i=0}finally{o=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}var o,i,s,u,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return u={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u},ee=this&&this.__awaiter||function(e,n,t,r){return new(t||(t=Promise))(function(o,i){function s(e){try{a(r.next(e))}catch(e){i(e)}}function u(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){e.done?o(e.value):new t(function(n){n(e.value)}).then(s,u)}a((r=r.apply(e,n||[])).next())})},ne=this&&this.__generator||function(e,n){function t(e){return function(n){return r([e,n])}}function r(t){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,i&&(s=i[2&t[0]?"return":t[0]?"throw":"next"])&&!(s=s.call(i,t[1])).done)return s;switch(i=0,s&&(t=[0,s.value]),t[0]){case 0:case 1:s=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,i=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(s=a.trys,!(s=s.length>0&&s[s.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3])){a.label=t[1];break}if(6===t[0]&&a.label<s[1]){a.label=s[1],s=t;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(t);break}s[2]&&a.ops.pop(),a.trys.pop();continue}t=n.call(e,a)}catch(e){t=[6,e],i=0}finally{o=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}var o,i,s,u,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return u={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u},te=t(6),re=new te.Schema({userId:String,token:String,lang:String,type:String},{timestamps:!0}),oe=te.model("Token",re),ie=oe,se=new te.Schema({deviceGroup:String,userId:String,tokens:[String]},{timestamps:!0}),ue=te.model("DeviceGroup",se),ae=ue,ce=this&&this.__awaiter||function(e,n,t,r){return new(t||(t=Promise))(function(o,i){function s(e){try{a(r.next(e))}catch(e){i(e)}}function u(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){e.done?o(e.value):new t(function(n){n(e.value)}).then(s,u)}a((r=r.apply(e,n||[])).next())})},fe=this&&this.__generator||function(e,n){function t(e){return function(n){return r([e,n])}}function r(t){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,i&&(s=i[2&t[0]?"return":t[0]?"throw":"next"])&&!(s=s.call(i,t[1])).done)return s;switch(i=0,s&&(t=[0,s.value]),t[0]){case 0:case 1:s=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,i=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(s=a.trys,!(s=s.length>0&&s[s.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3])){a.label=t[1];break}if(6===t[0]&&a.label<s[1]){a.label=s[1],s=t;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(t);break}s[2]&&a.ops.pop(),a.trys.pop();continue}t=n.call(e,a)}catch(e){t=[6,e],i=0}finally{o=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}var o,i,s,u,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return u={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u},le=t(8),de=new te.Schema({userId:String,password:String},{timestamps:!0});de.pre("save",function(e){var n=this;if(!n.isModified("password"))return e();le.genSalt(10,function(t,r){if(t)return e(t);le.hash(n.password,r,void 0,function(t,r){if(t)return e(t);n.password=r,e()})})}),de.methods.comparePassword=function(e,n){le.compare(e,this.password,function(e,t){n(e,t)})};var pe=te.model("User",de),he=pe,ve=t(9);n.verifyAuthToken=D,n.default=q;var ge=this&&this.__awaiter||function(e,n,t,r){return new(t||(t=Promise))(function(o,i){function s(e){try{a(r.next(e))}catch(e){i(e)}}function u(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){e.done?o(e.value):new t(function(n){n(e.value)}).then(s,u)}a((r=r.apply(e,n||[])).next())})},be=this&&this.__generator||function(e,n){function t(e){return function(n){return r([e,n])}}function r(t){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,i&&(s=i[2&t[0]?"return":t[0]?"throw":"next"])&&!(s=s.call(i,t[1])).done)return s;switch(i=0,s&&(t=[0,s.value]),t[0]){case 0:case 1:s=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,i=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(s=a.trys,!(s=s.length>0&&s[s.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3])){a.label=t[1];break}if(6===t[0]&&a.label<s[1]){a.label=s[1],s=t;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(t);break}s[2]&&a.ops.pop(),a.trys.pop();continue}t=n.call(e,a)}catch(e){t=[6,e],i=0}finally{o=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}var o,i,s,u,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return u={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u}},function(e,n){e.exports=require("xmlhttprequest")}]);